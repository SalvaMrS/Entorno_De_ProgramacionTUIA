#!/bin/bash

declare -A REPETICIONES

for PALABRA in $(grep -P -o '\b\w+\b' $1); do
	if [[ ${#PALABRA} > 3 ]]; then
		let REPETICIONES[$PALABRA]++
	fi
done

echo ${#REPETICONES[@]}

declare -A INVERSO

for PALABRA in ${!REPETICIONES[@]}; do
	INVERSO[${REPETICIONES[$PALABRA]}]+=" $PALABRA"
done

IFS=$'\n' LISTA=$( sort -r <<< "${REPETICIONES[*]}")
unset IFS

TOP=1

echo ""
echo "--- 10 palabras con mas apariciones en $1 ---"
echo ""

declare -A LIS

for E in ${LISTA[@]};do
	if [[ ($TOP != 10) && ($TOP != ${#LISTA}) ]]; then
		for I in ${!REPETICIONES[@]}; do
	echo "Top $TOP con $E apariciones:${INVERSO[$E]}"
				echo ""
				LIS[$TOP]=${REPETICIONES[$I]}
				let TOP++
			if [[ ${REPETICIONES[$I]} == $E && $TOP == 1 ]]; then
				echo "Top $TOP con $E apariciones:${INVERSO[$E]}"
				echo ""
				LIS[$TOP]=${REPETICIONES[$I]}
				let TOP++
			elif [[ ${REPETICIONES[$I]} == $E && ${REPETICIONES[$I]} != ${LIS[$($TOP - 1)]} ]]; then
				echo "Top $TOP con $E apariciones:${INVERSO[$E]}"
				echo ""
				LIS[$TOP]=${REPETICIONES[$I]}
				let TOP++
			fi
		done
	fi
done
